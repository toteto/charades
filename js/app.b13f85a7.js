(function(e){function t(t){for(var r,s,i=t[0],c=t[1],l=t[2],d=0,m=[];d<i.length;d++)s=i[d],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&m.push(a[s][0]),a[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);u&&u(t);while(m.length)m.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,i=1;i<n.length;i++){var c=n[i];0!==a[c]&&(r=!1)}r&&(o.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},a={app:0},o=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/charades/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var u=c;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=n("289d"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{staticClass:"columns is-centered"},[n("div",{staticClass:"column is-narrow"},[n("section",{staticClass:"section"},[n("GameHeader")],1),e.hostController||e.clientData?e._e():n("section",{staticClass:"section",staticStyle:{"padding-top":"0"}},[n("GameStarter",{attrs:{predefinedGameId:e.predefinedGameId},on:{"host-game":e.onHostGame,"join-game":e.onJoinGame}})],1),e.hostController?n("section",{staticClass:"section",staticStyle:{padding:"0.5rem 1.5rem"}},[n("GameHost",{attrs:{hostGameController:e.hostController}})],1):e._e(),e.clientData?n("section",{staticClass:"section",staticStyle:{"padding-top":"0.5rem"}},[n("GameClient",{attrs:{gameId:e.clientData.gameId,clientGameController:e.clientData.controller}})],1):e._e()])])])},s=[],i=(n("b0c0"),n("d3b7"),n("ac1f"),n("3ca3"),n("841c"),n("ddb0"),n("2b3d"),n("4de4"),n("7db0"),n("5db7"),n("4160"),n("d81d"),n("73d9"),n("159b"),n("2909")),c=n("d4ec"),l=n("bee2"),u=n("ade3"),d=(n("c740"),n("ace4"),n("25f0"),n("5319"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("5530")),m=n("a0bc"),f=n.n(m);function h(){var e={host:"peerjs-server.toteto.tech",port:9443,secure:!0};return new f.a(Object(d["a"])({},e,{config:{iceServers:[{url:"turn:numb.viagenie.ca",username:"antonioivanovski@gmail.com",credential:"LfeuhHqbto8JM+JwMYDbdjWdV"}]},debug:2}))}function p(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)}))}Array.prototype.elementAfter=function(e){var t=this.findIndex((function(t){return t===e}));return t>-1&&t<this.length?this[t+1]:null},Array.prototype.sample=function(){return this[Math.floor(Math.random()*this.length)]};var v=function(){function e(t){Object(c["a"])(this,e),Object(u["a"])(this,"_peer",null),Object(u["a"])(this,"_hostState",{get inProgress(){return null!=this.currentTurn},players:[]}),Object(u["a"])(this,"_onRoundFinishedReceiver",null),this._peer=t,this._registerForIncomingGameJoins()}return Object(l["a"])(e,null,[{key:"create",value:function(){var t=h();return new e(t)}}]),Object(l["a"])(e,[{key:"restore",value:function(e){this._hostState.players=Object(i["a"])(e.players),this._hostState.currentTurn=e.currentTurn&&{turnId:e.currentTurn.turnId,player:this._hostState.players.find((function(t){return t.name===e.currentTurn.player})),word:this._hostState.players.flatMap((function(e){return e.words})).find((function(t){return t.value===e.currentTurn.word.value&&t.guessed===e.currentTurn.word.guessed}))},console.log(this._hostState)}},{key:"gameId",value:function(){var e=this;return new Promise((function(t,n){e._peer.id?t(wordBowlPeer.id):e._peer.on("open",(function(e){t(e)}))}))}},{key:"startGame",value:function(){var e=this;return new Promise((function(t,n){e._updateStateForNextTurn(),e._sendPublicStateToPlayers(),t()}))}},{key:"onRoundFinished",value:function(e){this._onRoundFinishedReceiver=e}},{key:"_registerForIncomingGameJoins",value:function(){var e=this;this._peer.on("connection",(function(t){t.on("open",(function(){var n,r=e._hostState.players.find((function(e){return e.name===t.metadata.name}));r?(null===(n=r.conn)||void 0===n||n.close(),r.conn=t):(r={name:t.metadata.name,words:t.metadata.words.map((function(e){return{value:e,guessed:!1}})),score:0,conn:t},e._hostState.players.push(r));console.log("Player '".concat(r.name,"' has joined.")),e._registerForPlayerActions(r),e._sendPublicStateToPlayers()}))}))}},{key:"_registerForPlayerActions",value:function(e){var t=this;e.conn.on("data",(function(e){var n=t._hostState.currentTurn;e.id===(null===n||void 0===n?void 0:n.turnId)&&(n.player.score+=e.correct?1:0,n.word.guessed=e.correct,t._updateStateForNextTurn(),t._sendPublicStateToPlayers())}))}},{key:"_updateStateForNextTurn",value:function(){var e,t,n,r=this,a=this._hostState.players.flatMap((function(e){return e.words.filter((function(e){return!e.guessed}))}));a.length>0?this._hostState.currentTurn={turnId:p(),player:null!==(e=this._hostState.players.elementAfter(null===(t=this._hostState.currentTurn)||void 0===t?void 0:t.player))&&void 0!==e?e:this._hostState.players[0],word:a.sample()}:(this._hostState.currentTurn=null,null===(n=this._onRoundFinishedReceiver)||void 0===n||n.call(this,(function(){return new Promise((function(e,t){r._hostState.players.forEach((function(e){return e.words.forEach((function(e){return e.guessed=!1}))})),r._updateStateForNextTurn(),r._sendPublicStateToPlayers(),e()}))})))}},{key:"_sendPublicStateToPlayers",value:function(){var e={players:this._hostState.players.map((function(e){return{name:e.name,score:e.score}}))},t=this._hostState.currentTurn;this._hostState.players.forEach((function(n){var r,a=Object.assign({},e);t&&(a.currentTurn={player:t.player.name},t.player===n&&(a.currentTurn.turnId=t.turnId,a.currentTurn.word=t.word.value)),null===(r=n.conn)||void 0===r||r.send(a)})),localStorage.persistedHostState=JSON.stringify({state:{players:this._hostState.players.map((function(e){return Object.assign({},e,{conn:null})})),currentTurn:this._hostState.currentTurn&&Object.assign({},this._hostState.currentTurn,{player:this._hostState.currentTurn.player.name})},timestamp:Date.now()})}}]),e}(),g=function(){function e(t,n){Object(c["a"])(this,e),Object(u["a"])(this,"_peer",null),Object(u["a"])(this,"_userData",null),Object(u["a"])(this,"_onPlayersReceiver",null),Object(u["a"])(this,"_onCurrentTurnReceiver",null),Object(u["a"])(this,"_onNoCurrentTurnReceiver",null),this._peer=n,this._userData=t}return Object(l["a"])(e,null,[{key:"create",value:function(t){var n=h();return new e(t,n)}}]),Object(l["a"])(e,[{key:"joinGame",value:function(e){var t=this;return new Promise((function(n,r){var a=t._userData,o=a.name,s=a.words,i=t._peer.connect(e,{metadata:{name:o,words:s},serialization:"json",reliable:!0}),c=setTimeout((function(){i.close(),r()}),1e4);i.on("open",(function(){clearTimeout(c),t._registerForGameStateUpdates(i),n()}))}))}},{key:"onPlayersReceived",value:function(e){this._onPlayersReceiver=e}},{key:"onCurrentTurnReceived",value:function(e){this._onCurrentTurnReceiver=e}},{key:"onNoCurrentTurnAvailable",value:function(e){this._onNoCurrentTurnReceiver=e}},{key:"_registerForGameStateUpdates",value:function(e){var t=this;e.on("data",(function(n){var r;console.log(n),null===(r=t._onPlayersReceiver)||void 0===r||r.call(t,n.players);var a,o,s=n.currentTurn;s?null===(a=t._onCurrentTurnReceiver)||void 0===a||a.call(t,{player:s.player,word:s.word,correct:function(){return t._guess(e,s,!0)},incorrect:function(){return t._guess(e,s,!1)}}):null===(o=t._onNoCurrentTurnReceiver)||void 0===o||o.call(t)}))}},{key:"_guess",value:function(e,t,n){return new Promise((function(r,a){r(e.send({id:t.turnId,correct:n}))}))}}]),e}(),y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",[n("b-field",{attrs:{label:"Your name"}},[n("b-input",{attrs:{placeholder:"Add name"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),n("b-field",{attrs:{label:"Words"}},[n("b-taginput",{attrs:{ellipsis:"",maxtags:"5",placeholder:"Add words"},model:{value:e.words,callback:function(t){e.words=t},expression:"words"}})],1),n("p",{staticClass:"label"},[e._v("Join existing game")]),n("b-field",{attrs:{grouped:""}},[n("b-input",{staticClass:"is-expanded",attrs:{placeholder:"Game ID"},model:{value:e.gameId,callback:function(t){e.gameId=t},expression:"gameId"}}),n("p",{staticClass:"control"},[n("button",{staticClass:"button is-primary",attrs:{disabled:!e.validJoinInfo},on:{click:function(t){return e.$emit("join-game",{gameId:e.gameId,name:e.name,words:e.words})}}},[e._v(" Join ")])])],1),n("b-field",{attrs:{label:"Or, host new one"}},[n("p",{staticClass:"control"},[n("button",{staticClass:"button",attrs:{disabled:!e.validHostInfo},on:{click:function(t){return e.$emit("host-game",{name:e.name,words:e.words})}}},[e._v(" Host new game ")])])])],1)},_=[],b=(n("498a"),{props:{predefinedGameId:String},data:function(){return{gameId:this.$props.predefinedGameId,name:"",words:[]}},computed:{validJoinInfo:function(){var e;return this.validHostInfo&&(null===(e=this.gameId)||void 0===e?void 0:e.trim().length)>0},validHostInfo:function(){return this.name.trim().length>0&&this.words.length>0}}}),w=b,C=n("2877"),S=Object(C["a"])(w,y,_,!1,null,null,null),T=S.exports,I=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},j=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",[n("h1",{staticClass:"title"},[e._v("Buli's Charades")]),n("h2",{staticClass:"subtitle"},[e._v("A variation on the charades game that Buli has thought us.")])])}],G={},P=Object(C["a"])(G,I,j,!1,null,null,null),O=P.exports,k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.gameInProgress?e._e():n("section",[n("div",{staticClass:"tags has-addons"},[n("span",{staticClass:"tag is-medium"},[e._v("Game ID")]),n("span",{staticClass:"tag is-dark is-medium"},[e._v(e._s(e.gameId||"Hosting..."))]),e.gameId?n("button",{staticClass:"tag button is-medium",on:{click:e.copyJoinUrl}},[e._m(0),n("span",[e._v("Copy join URL")])]):e._e()]),e.gameId?n("b-button",{attrs:{type:"is-warning"},on:{click:e.startGame}},[e._v("START GAME")]):e._e()],1)},R=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"icon is-small"},[n("i",{staticClass:"fas fa-link"})])}],x=(n("99af"),{props:{hostGameController:v},data:function(){return{gameId:null,gameInProgress:!1,nextRoundStarter:null}},created:function(){var e=this;this.hostGameController.gameId().then((function(t){e.gameId=t})),this.hostGameController.onRoundFinished((function(t){e.gameInProgress=!1,e.nextRoundStarter=t}))},methods:{startGame:function(){var e=this;this.nextRoundStarter?this.nextRoundStarter().then((function(){e.gameInProgress=!0,e.nextRoundStarter=null})):this.hostGameController.startGame().then((function(){e.gameInProgress=!0}))},copyJoinUrl:function(){var e=this,t=new URL(location.href),n=new URLSearchParams(t.search);n.append("gameId",this.gameId),navigator.clipboard.writeText("".concat(t.origin).concat(t.pathname,"?").concat(n.toString())).then((function(){e.$buefy.toast.open({message:"Game URL copied to clipboard",type:"is-info"})})).catch((function(){e.$buefy.toast.open({message:"Failed to copy Game URL to clipboard. Copy it manualy :(",type:"is-danger"})}))}}}),A=x,F=Object(C["a"])(A,k,R,!1,null,null,null),D=F.exports,$=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"field is-grouped"},e._l(e.players,(function(t){return n("div",{key:t.name,staticClass:"control"},[n("div",{staticClass:"tags has-addons are-small"},[n("span",{staticClass:"tag",class:{"is-info":t.name===e.currentPlayer}},[e._v(e._s(t.name))]),n("span",{staticClass:"tag is-info"},[e._v(e._s(t.score))])])])})),0),e.myTurn?n("MyTurn",{attrs:{word:e.myTurn.word,correctAction:e.myTurn.correctAction,incorrectAction:e.myTurn.incorrectAction}}):e._e()],1)},J=[],E=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card"},[e._m(0),n("div",{staticClass:"card-content"},[n("p",{staticClass:"title"},[e._v(e._s(e.word))])]),n("div",{staticClass:"card-footer"},[n("a",{staticClass:"card-footer-item",on:{click:function(t){return e.correctAction()}}},[e._v("Correct")]),n("a",{staticClass:"card-footer-item is-danger",on:{click:function(t){return e.incorrectAction()}}},[e._v("Incorrect")])])])},H=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card-header"},[n("p",{staticClass:"card-header-title"},[e._v("Your turn")])])}],M={props:{word:String,correctAction:Function,incorrectAction:Function}},U=M,N=Object(C["a"])(U,E,H,!1,null,null,null),L=N.exports,Y={props:{gameId:String,clientGameController:g},data:function(){return{players:null,currentPlayer:null,myTurn:null}},created:function(){var e=this,t=function t(){return e.clientGameController.joinGame(e.gameId).then((function(){console.log("Connected to ".concat(e.gameId))})).catch((function(){e.$buefy.dialog.confirm({message:"Failed connecting to game. Try again?",onConfirm:function(){return t()}})}))};t(),this.clientGameController.onPlayersReceived((function(t){e.players=t})),this.clientGameController.onCurrentTurnReceived((function(t){e.currentPlayer=t.player,e.myTurn=t.word&&{word:t.word,correctAction:t.correct,incorrectAction:t.incorrect}})),this.clientGameController.onNoCurrentTurnAvailable((function(){e.currentPlayer=null,e.myTurn=null}))},components:{MyTurn:L}},B=Y,W=Object(C["a"])(B,$,J,!1,null,null,null),V=W.exports,q={data:function(){var e=new URLSearchParams(new URL(window.location.href).search);return{predefinedGameId:e.get("gameId"),hostController:null,clientData:null}},created:function(){var e=this,t=localStorage.persistedHostState&&JSON.parse(localStorage.persistedHostState),n=t.timestamp,r=t.state;n>Date.now()-9e4&&this.$buefy.snackbar.open({message:"You have hosted a game very recenly. Would you like to continue hosting that game?",position:"is-top",actionText:"Yes",duration:5e3,onAction:function(){e.hostController=v.create(),e.hostController.restore(r)}})},methods:{onHostGame:function(e){var t=this;this.hostController=v.create(),this.hostController.gameId().then((function(n){t.clientData={controller:g.create({name:e.name,words:e.words}),gameId:n}}))},onJoinGame:function(e){this.clientData={controller:g.create({name:e.name,words:e.words}),gameId:e.gameId}}},name:"App",components:{GameStarter:T,GameHeader:O,GameHost:D,GameClient:V}},z=q,K=(n("5c0b"),Object(C["a"])(z,o,s,!1,null,null,null)),Q=K.exports;r["a"].use(a["a"]),r["a"].config.productionTip=!1,new r["a"]({render:function(e){return e(Q)}}).$mount("#app")},"5c0b":function(e,t,n){"use strict";var r=n("9c0c"),a=n.n(r);a.a},"5e11":function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="5e11"},"9c0c":function(e,t,n){}});
//# sourceMappingURL=app.b13f85a7.js.map